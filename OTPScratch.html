<html>
<head>
    <title>Scratch Stuff</title>

    <style type="text/css">
        /* 13. Basic Styling with CSS */

        /* Style the lines by removing the fill and applying a stroke */
        .line {
            fill: none;
            stroke: #ffab00;
            stroke-width: 3;
        }

        .overlay {
            fill: none;
            pointer-events: all;
        }

        /* Style the dots by assigning a fill and stroke */
        .dot {
            fill: #ffab00;
            stroke: #fff;
        }

        .focus circle {
            fill: none;
            stroke: steelblue;
        }

    </style>
    <script src="https://d3js.org/d3.v4.js"></script>
</head>

<body>
    <div id="my_dataviz"></div>
<script>

    // set the dimensions and margins of the graph


    var margin = {top: 10, right: 30, bottom: 30, left: 60},
        width = 460 - margin.left - margin.right,
        height = 400 - margin.top - margin.bottom;

    // append the svg object to the body of the page
    var svg = d3.select("#my_dataviz")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform",
            "translate(" + margin.left + "," + margin.top + ")");

    var OTPdata;

    var routeID;
    var serviceDate;
    var peak_or_offPeak;
    var OTPNum;
    var OTPDen;
    var HAScore;

    var parseDate = d3.timeParse("%Y-%m-%d");

    d3.csv("data/OTP by month/Month-by-Month OTP Score.csv",


        // When reading the csv, I must format variables:
        function(d){
            return { gtfs_route_id: d.gtfs_route_id, date : d.month, headway_score : d.headway_score }
        },

        // Now I can use this dataset:
        function(data) {

            // Add X axis --> it is a date format
            var x = d3.scaleTime()
                .domain(d3.extent(data, function(d) { return d.date; }))
                .range([ 0, width ]);
            svg.append("g")
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(x));

            // Add Y axis
            var y = d3.scaleLinear()
                .domain([0, d3.max(data, function(d) { return +d.headway_score; })])
                .range([ height, 0 ]);
            svg.append("g")
                .call(d3.axisLeft(y));

            function routeOne(all_route_data) {
                var routeOneData = all_route_data.filter(function(d) {
                    if (d["gtfs_route_id"] === "1")
                    {
                        return d;
                    }
                });

                svg.append("path")
                    .datum(routeOneData)
                    .attr("fill", "none")
                    .attr("stroke", "steelblue")
                    .attr("stroke-width", 1.5)
                    .attr("d", d3.line()
                        .x(function(d) { return x(d.date) })
                        .y(function(d) { return y(d.headway_score) })
                    )
            }

            function route43(all_route_data) {
                var route43Data = all_route_data.filter(function(d) {
                    if (d["gtfs_route_id"] === "43")
                    {
                        return d;
                    }
                });

                svg.append("path")
                    .datum(route43Data)
                    .attr("fill", "none")
                    .attr("stroke", "steelblue")
                    .attr("stroke-width", 1.5)
                    .attr("d", d3.line()
                        .x(function(d) { return x(d.date) })
                        .y(function(d) { return y(d.headway_score) })
                    )
            }

            function route749(all_route_data) {
                var route749Data = all_route_data.filter(function(d) {
                    if (d["gtfs_route_id"] === "749")
                    {
                        return d;
                    }
                });

                svg.append("path")
                    .datum(route749Data)
                    .attr("fill", "none")
                    .attr("stroke", "steelblue")
                    .attr("stroke-width", 1.5)
                    .attr("d", d3.line()
                        .x(function(d) { return x(d.date) })
                        .y(function(d) { return y(d.headway_score) })
                    )
            }

            function route751(all_route_data) {
                var route751Data = all_route_data.filter(function(d) {
                    if (d["gtfs_route_id"] === "751")
                    {
                        return d;
                    }
                });

                svg.append("path")
                    .datum(route751Data)
                    .attr("fill", "none")
                    .attr("stroke", "steelblue")
                    .attr("stroke-width", 1.5)
                    .attr("d", d3.line()
                        .x(function(d) { return x(d.date) })
                        .y(function(d) { return y(d.headway_score) })
                    )
            }

            routeOne(data);
            route43(data);
            route749(data);
            route751(data);

/*            svg.append("path")
                .datum(data)
                .attr("fill", "none")
                .attr("stroke", "steelblue")
                .attr("stroke-width", 1.5)
                .attr("d", d3.line()
                    .x(function(d) { return x(d.date) })
                    .y(function(d) { return y(d.headway_score) })
                )*/

            /*// Add the line
            svg.append("path")
                .datum(data)
                .filter(function(d) { return d.gtfs_route_id === "1"})
                .attr("fill", "none")
                .attr("stroke", "steelblue")
                .attr("stroke-width", 1.5)
                .attr("d", d3.line()
                    .x(function(d) { return x(d.date) })
                    .y(function(d) { return y(d.headway_score) })
                )

            svg.append("path")
                .datum(data)
                .filter(function(d) { return d.gtfs_route_id === "43"})
                .attr("fill", "none")
                .attr("stroke", "steelblue")
                .attr("stroke-width", 1.5)
                .attr("d", d3.line()
                    .x(function(d) { return x(d.date) })
                    .y(function(d) { return y(d.headway_score) })
                )

            svg.append("path")
                .datum(data)
                .filter(function(d) { return d.gtfs_route_id === "749"})
                .attr("fill", "none")
                .attr("stroke", "steelblue")
                .attr("stroke-width", 1.5)
                .attr("d", d3.line()
                    .x(function(d) { return x(d.date) })
                    .y(function(d) { return y(d.headway_score) })
                )

            svg.append("path")
                .datum(data)
                .filter(function(d) { return d.gtfs_route_id === "751"})
                .attr("fill", "none")
                .attr("stroke", "steelblue")
                .attr("stroke-width", 1.5)
                .attr("d", d3.line()
                    .x(function(d) { return x(d.date) })
                    .y(function(d) { return y(d.headway_score) })
                )*/

        })

/*    //read the data
d3.csv("data/OTP by month/Full_List_of_ChesterSquare_stops_OTPs.csv").then(function(data){
    OTPdata = data;
    //return

}).then(function(){

    var i;
    for (i = 0; i < OTPdata.length; i++) {
        let OTPscore = OTPdata[i];
        routeID = OTPscore["gtfs_route_id"];
        serviceDate = OTPscore["service_date"];
        peak_or_offPeak = OTPscore["peak_offpeak_ind"];
        OTPNum = OTPscore ["otp_numerator"];
        OTPDen = OTPscore["otp_denominator"];
        HAScore = OTPscore["Headway Analysis (Schedule Adherence) Score"];
    }

    var y = d3.scaleLinear()
        .domain([HAScore.min, HAScore.max])
        .range([0, 600]);
    svg.append("g")
        .call(d3.axisBottom(x));

    var x = d3.scaleTime()
        .domain([serviceDate.min, serviceDate.max])
        .range([0, 1]);
    svg.append("g")
        .call(d3.axisLeft(y));

        //var yAxis = d3.axisLeft(y);
        //var xAxis = d3.axisBottom(x);

        //var line = d3.line()
        //.x(function(data){return x(data.date)})

    });*/




    /*.row(function(d){return {date: parseDate(d.date), HA: Float32Array (d.price.trim())};})
    .get(function(error,rows) {
        max = d3.max(rows, function (d) {
            return d.price;
        });
        minDate = d3.min(rows, function (d) {
            return d.month;
        });
        maxDate = d3.max(rows, function (d) {
            return d.month;
        });


    });*/





</script>
</body>


</html>